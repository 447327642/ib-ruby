#!/usr/bin/env ruby
#
# This script connects to IB API, subscribes to account info and prints out
# messages received from IB (update every 3 minute or so)

require 'rubygems'
require 'bundler/setup'
$LOAD_PATH.unshift File.expand_path(File.dirname(__FILE__) + '/../lib')
require 'ib-ruby'

# Start the Gateway and initialize the active-accounts
IB::Gateway.new get_account_data:true

accounts = IB::Gateway.current.active_accounts
puts ""
accounts.each do |account|
  puts "Contracts ------------------> #{account.account } <----------------------"
  puts account.contracts.map( &:to_human ).join( "\n" )
  puts "-----------------"

end
accounts.each do |account|
  puts "Portfolio_values ------------> #{account.account } <----------------------"
  puts account.portfolio_values.map &:to_human
  puts "-----------------"
end

accounts.each do |account|
  puts "Account_values ------------> #{account.account } <----------------------"
  puts account.account_values.map{|x| x.to_human if x.value.present? && !x.value.to_i.zero? }.compact  
  puts "-----------------"

end
